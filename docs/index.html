<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi-Omics Database | Home</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://unpkg.com/cytoscape@3.26.2/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<h1>Multi-Omics Database</h1>

<nav class="navbar">
    <div class="nav-left">
        <a href="index.html" class="logo">
            <img src="assets/logo.png" alt="Multi-Omics Database">
            <span>Multi-Omics DB</span>
        </a>
    </div>

    <div class="nav-right">
        <a href="index.html">Home</a>
        <a href="downloads.html">Downloads</a>
        <a href="statistics.html">Statistics</a>
        <a href="network.html">Network</a>
        <a href="about.html">About</a>
    </div>
</nav>


<h2>Project Overview</h2>
<p>
This database provides a comprehensive collection of multi-omics datasets generated from a large-scale
integrative study, including transcriptomics, metatranscriptomics, metabolomics,
and microbial community profiling of bacteria, fungi, and viruses.
</p>

<p>
The resource is designed to facilitate systematic exploration of cross-omics interactions
and to support reproducible computational analyses.
</p>

<h2>Integrated Multi-Omics Network</h2>

<p>
We present an interactive overview of multi-omics correlation networks,
integrating microbial taxa, host genes.
Nodes are colored by biological category, and edges represent significant correlations.
</p>

<div id="cy" style="width:100%; height:520px; border:1px solid #ddd;"></div>


<script>
const CORR_THRESHOLD = 0.4;

Papa.parse("data/matrices/data.csv", {
    download: true,
    header: true,
    complete: function(res) {
        const nodes = {};
        const edges = [];
        
        // 获取所有基因列名（从第三列开始）
        const columns = res.meta.fields;
        const microbeNameCol = columns[0]; // 第一列：微生物名称
        const groupCol = columns[1]; // 第二列：分组信息
        const geneCols = columns.slice(2); // 第三列开始：基因列
        
        res.data.forEach(row => {
            const microbe = row[microbeNameCol];
            const group = row[groupCol];
            
            // 跳过空行
            if (!microbe || !group) return;
            
            // 创建微生物节点
            if (!nodes[microbe]) {
                nodes[microbe] = {
                    data: {
                        id: microbe,
                        type: group // 直接使用第二列的分组信息
                    }
                };
            }
            
            // 创建基因节点并添加边
            geneCols.forEach(gene => {
                const corrValue = row[gene];
                const r = parseFloat(corrValue);
                
                if (!isNaN(r) && Math.abs(r) >= CORR_THRESHOLD) {
                    // 创建基因节点（如果不存在）
                    if (!nodes[gene]) {
                        nodes[gene] = {
                            data: {
                                id: gene,
                                type: "Gene" // 基因节点类型
                            }
                        };
                    }
                    
                    // 添加边
                    edges.push({
                        data: {
                            source: microbe,
                            target: gene,
                            weight: r,
                            type: r > 0 ? "positive" : "negative"
                        }
                    });
                }
            });
        });

        const elements = [...Object.values(nodes), ...edges];

        cytoscape({
            container: document.getElementById("cy"),
            elements: elements,
            style: [
                {
                    selector: "node",
                    style: {
                        "label": "data(id)",
                        "font-size": "7px",
                        "background-color": ele => {
                            const type = ele.data("type");
                            const colorMap = {
                                "Bacterial": "#1f77b4",
                                "Virus": "#2ca02c",
                                "Fungi": "#ff7f0e",
                                "VF": "#9467bd", // 病毒-真菌交互
                                "Gene": "#7f7f7f" // 基因节点
                            };
                            // 不区分大小写
                            const lowerType = type.toLowerCase();
                            return colorMap[lowerType] || "#d62728";
                        }
                    }
                },
                {
                    selector: "edge",
                    style: {
                        "width": ele => Math.abs(ele.data("weight")) * 3,
                        "line-color": ele => ele.data("weight") > 0 ? "#ff4d4d" : "#4d79ff",
                        "opacity": 0.6,
                        "curve-style": "bezier"
                    }
                }
            ],
            layout: {
                name: "cose",
                animate: false,
                componentSpacing: 100,
                nodeRepulsion: 100000,
                idealEdgeLength: 100
            }
        });
        
        // 添加图例
        const legendData = [
            { label: "Bacteria", color: "#1f77b4" },
            { label: "Virus", color: "#2ca02c" },
            { label: "Fungi", color: "#ff7f0e" },
            { label: "VF", color: "#9467bd" },
            { label: "Gene", color: "#7f7f7f" },
            { label: "Positive Correlation", color: "#ff4d4d" },
            { label: "Negative Correlation", color: "#4d79ff" }
        ];
        
        const legend = document.createElement("div");
        legend.style.cssText = `
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
            font-size: 12px;
            z-index: 1000;
        `;
        
        legendData.forEach(item => {
            const itemDiv = document.createElement("div");
            itemDiv.style.cssText = `
                display: flex;
                align-items: center;
                margin: 5px 0;
            `;
            
            const colorBox = document.createElement("div");
            colorBox.style.cssText = `
                width: 15px;
                height: 15px;
                background-color: ${item.color};
                margin-right: 8px;
                border: 1px solid #ccc;
            `;
            
            itemDiv.appendChild(colorBox);
            itemDiv.appendChild(document.createTextNode(item.label));
            legend.appendChild(itemDiv);
        });
        
        document.getElementById("cy").appendChild(legend);
    }
});
</script>

<p>
<a class="button" href="network.html">Explore Correlation Network</a>
</p>

</body>
</html>

