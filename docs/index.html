<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi-Omics Database | Home</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://unpkg.com/cytoscape@3.26.2/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<h1>Multi-Omics Database</h1>

<nav class="navbar">
    <div class="nav-left">
        <a href="index.html" class="logo">
            <img src="assets/logo.png" alt="Multi-Omics Database">
            <span>Multi-Omics DB</span>
        </a>
    </div>

    <div class="nav-right">
        <a href="index.html">Home</a>
        <a href="downloads.html">Downloads</a>
        <a href="statistics.html">Statistics</a>
        <a href="network.html">Network</a>
        <a href="about.html">About</a>
    </div>
</nav>


<h2>Project Overview</h2>
<p>
This database provides a comprehensive collection of multi-omics datasets generated from a large-scale
integrative study, including transcriptomics, metatranscriptomics, metabolomics,
and microbial community profiling of bacteria, fungi, and viruses.
</p>

<p>
The resource is designed to facilitate systematic exploration of cross-omics interactions
and to support reproducible computational analyses.
</p>

<h2>Integrated Multi-Omics Network</h2>

<p>
We present an interactive overview of multi-omics correlation networks,
integrating microbial taxa, host genes.
Nodes are colored by biological category, and edges represent significant correlations.
</p>

<div id="cy" style="width:100%; height:520px; border:1px solid #ddd;"></div>

<script>
const CORR_THRESHOLD = 0.4;

Papa.parse("data/matrices/data.csv", {
    download: true,
    header: true,
    complete: function(res) {
        const nodes = {};
        const edges = [];
        
        const nodeNames = res.data.map(row => row[Object.keys(row)[0]]);
        
        const nodeTypes = res.data.map(row => row[Object.keys(row)[1]]);
        
      
        res.data.forEach(row => {
            const nodeId = row[Object.keys(row)[0]];  
            const nodeType = row[Object.keys(row)[1]]; 
            
            if (nodeId && !nodes[nodeId]) {
                nodes[nodeId] = { 
                    data: { 
                        id: nodeId, 
                        type: nodeType || "Unknown" 
                    }
                };
            }
        });
        

        res.data.forEach(row => {
            const source = row[Object.keys(row)[0]];  
            
           
            Object.keys(row).slice(2).forEach(target => {
                const val = row[target];
                const r = parseFloat(val);
                
                
                if (!nodes[target]) {
                   
                    const targetRow = res.data.find(r => r[Object.keys(r)[0]] === target);
                    const targetType = targetRow ? targetRow[Object.keys(row)[1]] : "Unknown";
                    
                    nodes[target] = {
                        data: {
                            id: target,
                            type: targetType
                        }
                    };
                }
                
                if (!isNaN(r) && Math.abs(r) >= CORR_THRESHOLD && source !== target) {
                    edges.push({
                        data: { 
                            source: source, 
                            target: target, 
                            weight: r 
                        }
                    });
                }
            });
        });

        const elements = [...Object.values(nodes), ...edges];
        
        
        const uniqueTypes = [...new Set(Object.values(nodes).map(n => n.data.type))];
        const typeColors = {
            "Bacteria": "#1f77b4",
            "Fungi": "#ff7f0e",
            "Virus": "#2ca02c",
            "Other": "#d62728",
            "Unknown": "#cccccc"
        };
        
        
        uniqueTypes.forEach(type => {
            if (!typeColors[type]) {
                
                const hue = Math.floor(Math.random() * 360);
                typeColors[type] = `hsl(${hue}, 70%, 50%)`;
            }
        });

        cytoscape({
            container: document.getElementById("cy"),
            elements: elements,
            style: [
                {
                    selector: "node",
                    style: {
                        "label": "data(id)",
                        "font-size": "7px",
                        "background-color": ele => typeColors[ele.data("type")] || "#cccccc",
                        "text-valign": "center",
                        "text-halign": "center"
                    }
                },
                {
                    selector: "edge",
                    style: {
                        "width": "mapData(weight, 0.6, 1, 1, 4)",
                        "line-color": ele => {
                            const weight = ele.data("weight");
                            return weight > 0 ? "#2ca02c" : "#d62728"; 
                        },
                        "opacity": 0.6
                    }
                }
            ],
            layout: {
                name: "cose",
                animate: false,
                nodeDimensionsIncludeLabels: true
            }
        });
        
        createLegend(uniqueTypes, typeColors);
    }
});

function createLegend(types, colors) {
    const legend = document.createElement("div");
    legend.style.cssText = `
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
    `;
    
    legend.innerHTML = '<h4 style="margin-top:0;">节点类型</h4>';
    
    types.forEach(type => {
        const item = document.createElement("div");
        item.style.cssText = `
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        `;
        item.innerHTML = `
            <span style="display:inline-block; width:12px; height:12px; 
                         background-color:${colors[type]}; margin-right:5px;"></span>
            <span>${type}</span>
        `;
        legend.appendChild(item);
    });
    
    document.getElementById("cy").parentNode.appendChild(legend);
}
</script>


<p>
<a class="button" href="network.html">Explore Correlation Network</a>
</p>

</body>
</html>



